<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Controle de Caixa</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    .totais { margin-top: 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .card { background: #fafafa; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
    .acoes button { margin: 0 2px; }
    .modal { display:none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:20px; border-radius:8px; width:300px; }
    .close { float:right; cursor:pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Controle de Caixa</h1>

    <div>
      <label>Categoria:</label>
      <select id="cat">
        <option value="cartao">Cart√£o</option>
        <option value="cartao_parcelado">Cart√£o Parcelado</option>
        <option value="pix_chave">Pix Chave</option>
        <option value="pix_maquina">Pix M√°quina</option>
        <option value="convenio">Conv√™nio</option>
        <option value="prazo">Prazo</option>
      </select>
      <label>Valor:</label>
      <input id="valor" type="text" placeholder="0,00">
      <button id="add">Adicionar</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Categoria</th>
          <th>Valor</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="totais">
      <div class="card">Cart√£o: R$ <span id="t_cartao">0,00</span></div>
      <div class="card">Cart√£o Parcelado: R$ <span id="t_cartao_parcelado">0,00</span></div>
      <div class="card">Pix Chave: R$ <span id="t_pix_chave">0,00</span></div>
      <div class="card">Pix M√°quina: R$ <span id="t_pix_maquina">0,00</span></div>
      <div class="card">Conv√™nio: R$ <span id="t_convenio">0,00</span></div>
      <div class="card">Prazo: R$ <span id="t_prazo">0,00</span></div>
    </div>
  </div>

  <!-- Modal edi√ß√£o -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h3>Editar Lan√ßamento</h3>
      <label>Categoria:</label>
      <select id="editCat">
        <option value="cartao">Cart√£o</option>
        <option value="cartao_parcelado">Cart√£o Parcelado</option>
        <option value="pix_chave">Pix Chave</option>
        <option value="pix_maquina">Pix M√°quina</option>
        <option value="convenio">Conv√™nio</option>
        <option value="prazo">Prazo</option>
      </select>
      <label>Valor:</label>
      <input id="editValor" type="text">
      <button id="saveEdit">Salvar</button>
    </div>
  </div>

  <script>
    let dados = JSON.parse(localStorage.getItem("dados")||"[]");
    let totals = {};
    let editIndex = null;

    const $tbody = document.getElementById("tbody");
    const $valor = document.getElementById("valor");
    const $cat = document.getElementById("cat");
    const $editModal = document.getElementById("editModal");
    const $editCat = document.getElementById("editCat");
    const $editValor = document.getElementById("editValor");

    function salvar() {
      localStorage.setItem("dados", JSON.stringify(dados));
    }
    function round2(n){ return Math.round(n*100)/100; }

    function keyToLabel(k){
      return {
        cartao:"Cart√£o",
        cartao_parcelado:"Cart√£o Parcelado",
        pix_chave:"Pix Chave",
        pix_maquina:"Pix M√°quina",
        convenio:"Conv√™nio",
        prazo:"Prazo"
      }[k] || k;
    }
    function labelToKey(l){
      const map = {
        "Cart√£o":"cartao",
        "Cart√£o Parcelado":"cartao_parcelado",
        "Pix Chave":"pix_chave",
        "Pix M√°quina":"pix_maquina",
        "Conv√™nio":"convenio",
        "Prazo":"prazo"
      };
      return map[l] || null;
    }

    // Fun√ß√£o para recalcular os totais a partir dos lan√ßamentos
    function recalcularTotais() {
      totals = {cartao:0, cartao_parcelado:0, pix_chave:0, pix_maquina:0, convenio:0, prazo:0};
      dados.forEach(d => {
        const key = labelToKey(d.cat);
        if (key) {
          totals[key] = round2((totals[key] || 0) + d.valor);
        }
      });
    }

    function render(){
      $tbody.innerHTML="";
      dados.forEach((d,i)=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${d.cat}</td>
          <td>R$ ${d.valor.toFixed(2).replace(".",",")}</td>
          <td class="acoes">
            <button onclick="editar(${i})">‚úèÔ∏è</button>
            <button onclick="excluir(${i})">üóëÔ∏è</button>
          </td>`;
        $tbody.appendChild(tr);
      });
      // Atualizar totais
      document.getElementById("t_cartao").innerText = totals.cartao.toFixed(2).replace(".",",");
      document.getElementById("t_cartao_parcelado").innerText = totals.cartao_parcelado.toFixed(2).replace(".",",");
      document.getElementById("t_pix_chave").innerText = totals.pix_chave.toFixed(2).replace(".",",");
      document.getElementById("t_pix_maquina").innerText = totals.pix_maquina.toFixed(2).replace(".",",");
      document.getElementById("t_convenio").innerText = totals.convenio.toFixed(2).replace(".",",");
      document.getElementById("t_prazo").innerText = totals.prazo.toFixed(2).replace(".",",");
    }

    document.getElementById("add").addEventListener("click",()=>{
      const valorNum=parseFloat(String($valor.value).replace(/\./g,'').replace(",","."));
      if(isNaN(valorNum)||valorNum<=0)return;
      const cat=$cat.value;
      const item={cat:keyToLabel(cat),valor:round2(valorNum)};
      dados.push(item);
      recalcularTotais();
      salvar(); render();
      $valor.value="";
    });

    window.editar=(i)=>{
      editIndex=i;
      const item=dados[i];
      $editCat.value=labelToKey(item.cat);
      $editValor.value=item.valor.toFixed(2).replace(".",",");
      $editModal.style.display="flex";
    };

    // Salvar edi√ß√£o
    document.getElementById('saveEdit').addEventListener('click', () => {
      if (editIndex === null) return;
      const item = dados[editIndex];

      const novaCat = $editCat.value; // chave nova
      const novoValorNum = parseFloat(String($editValor.value).replace(/\./g,'').replace(',', '.'));
      if (isNaN(novoValorNum) || novoValorNum <= 0) return;

      // Atualiza o item (r√≥tulo + valor)
      item.cat = keyToLabel(novaCat);
      item.valor = round2(novoValorNum);

      // Recalcula todos os totais
      recalcularTotais();

      editIndex = null;
      $editModal.style.display = 'none';
      salvar(); render();
    });

    // Excluir
    window.excluir = (i) => {
      if (!confirm("Excluir este lan√ßamento?")) return;
      dados.splice(i, 1);

      // Recalcula todos os totais
      recalcularTotais();

      salvar(); render();
    };

    document.getElementById("closeModal").addEventListener("click",()=>{$editModal.style.display="none"; editIndex=null;});

    recalcularTotais();
    render();
  </script>
</body>
</html>
